---
title: "EDA: Analysis of Suicide Rate with Other Parameters"
author: "Magdalene"
execute: 
  warning: false
---

# Load Packages and Data Set

```{r}
pacman::p_load(tidyverse, ExPanDaR, knitr, ggstatsplot)

suicide_analysis <- read.csv('data/suicidedata_analysis.csv', header = T)
```

# Visualising Missing Values

```{r}
missing.values <- suicide_analysis %>%
    pivot_longer(cols = SR_AS_M:mental_disorder, 
                 names_to = "rate",
                 values_to = "values") %>%
    mutate(is.missing = is.na(values)) %>%
    group_by(rate, is.missing) %>%
    summarise(num.missing = n()) %>%
    filter(is.missing==T) %>%
    select(-is.missing) %>%
    arrange(desc(num.missing)) 

missing.values %>% kable()
```

```{r}
prepare_missing_values_graph(df = suicide_analysis
                               |> select(region, year,
                                         gdp_per_capita:mental_disorder), 
                               ts_id = "region")
```

```{r}
prepare_missing_values_graph(df = suicide_analysis 
                             |> select(year, gdp_per_capita:mental_disorder), 
                               ts_id = "year")
```

As there is a large amount of missing values between the years 1990 to 2005 for a few variables, we will filter the data down to only include values from 2005 onwards. We will also exclude the variable "Average hours worked" since there is a consistently high proportion of missing values.

```{r}
prepare_missing_values_graph(df = suicide_analysis 
                             |> filter(year %in% seq(2005,2020,1))
                             |> select(region, year,
                                       gdp_per_capita:mental_disorder)
                             |> select(!avg_hrs_worked), 
                               ts_id = "region")
```

This seems to bring down the proportion of missing values, but there remains areas and variables with a high number of missing values. Let's take a look at how the missing values are distributed within countries in each region.

```{r}
missing_val_graph <- function(a){
  prepare_missing_values_graph(df = suicide_analysis 
                             |> filter(year %in% seq(2005,2020,1))
                             |> filter(region == a)
                             |> select(region, country, year,
                                       gdp_per_capita:mental_disorder)
                             |> select(!avg_hrs_worked), 
                               ts_id = "country")
}
```

```{r}
missing_val_graph("Sub-Saharan Africa")
```

```{r}
missing_val_graph("Middle East and North Africa")
```

```{r}
missing_val_graph("South Asia")
```

```{r}
missing_val_graph("East Asia and Pacific")
```

```{r}
missing_val_graph("North America")
```

```{r}
missing_val_graph("Europe and Central Asia")
```

# Missing Values Graph v2 after exclusions

```{r}
exclude_countries <- c('Afghanistan', 'Maldives', 'Bhutan', 'Bermuda', 
                       'San Marino', 'Monaco', 'Greenland', 'Andorra',
                       'Montenegro', 'Turkmenistan', 'Iceland', 'Luxembourg',
                       'Serbia', 'Cyprus', 'Vanuatu', 'Tuvalu', 'Tokelau',
                       'Solomon Islands', 'Papau New Guinea', 'Palau', 
                       'Northern Mariana Islands', 'Samoa', 'North Korea', 
                       'Niue', 'Nauru', 'Guam', 'Cook Islands', 'Timor-Leste',
                       'American Samoa', 'Marshall Islands', 'Tonga', 'Taiwan',
                       'Papua New Guinea', 'Micronesia', 'Kiribati', 'Fiji',
                       'Brunei')

missing_val_graph_v2 <- function(a){
  prepare_missing_values_graph(df = suicide_analysis 
                             |> filter(year %in% seq(2005,2020,1))
                             |> filter(!(country %in% exclude_countries))
                             |> filter(region == a)
                             |> select(region, country, year,                                         gdp_per_capita:mental_disorder)
                             |> select(!avg_hrs_worked), 
                               ts_id = "country")
}
```

```{r}
missing_val_graph_v2("South Asia")
```

```{r}
missing_val_graph_v2("North America")
```

```{r}
missing_val_graph_v2("Europe and Central Asia")
```

```{r}
missing_val_graph_v2("East Asia and Pacific")
```

# Comparison between Factors

```{r}
suicide_analysis_factors <- suicide_analysis %>%
  select(gdp_per_capita:mental_disorder)

ggcorrmat(data = suicide_analysis_factors, ggcorrplot.args = list(lab_size = 2)) + 
  theme(axis.text.x = element_text(size = 7, angle = 90, vjust = 0.5, hjust=1),
        axis.text.y = element_text(size =7, vjust = 0.3)) 
```

```{r}
correl_plot <- function(df, col_x, col_y){
  ggscatterstats(data = df |> filter(!is.na({{col_x}})) 
                 |> filter(!is.na({{col_y}})), 
                 x = {{col_x}}, y = {{col_y}}, 
                 type = "nonparametric") + 
      theme(axis.text.x = element_text(size = 7, angle = 90, vjust = 1, hjust=1),
            axis.text.y = element_text(size =7)) +
      labs(title = paste0("Correlation between ", deparse(substitute(col_x)), 
                      " and ", deparse(substitute(col_y))))
}
```

```{r}
correl_plot(suicide_analysis, gdp_per_capita, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, hdi, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, depr_rate, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, gini, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, violent_death_rate, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, pop.extreme_poverty, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, unemployment_rate, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, avg_hrs_worked, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, HAQ, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, healthcare_spend, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, DALYs_NCD, SR_AS_T)
```

```{r}
correl_plot(suicide_analysis, happiness, SR_AS_T)
```
